#!/bin/bash
# Transfer SRA download fix to cluster

echo "Transferring SRA download fix to cluster..."
echo "ğŸ”§ SRA DOWNLOAD FIXES:"
echo "1. âœ… Enhanced SRA downloader with multiple fallback methods"
echo "2. âœ… Entrez API integration for SRA data search"
echo "3. âœ… SRA Toolkit installation script"
echo "4. âœ… Alternative download methods (Run Browser, HTTP)"
echo "5. âœ… Proper error handling and logging"
echo "6. âœ… Based on official NCBI documentation"
echo ""

echo "Transferring files..."
scp src/sra_download_fix.py ul_oqn09@uc3.scc.kit.edu:~/als_foundation_model/src/
scp src/parallel_optimized_pipeline.py ul_oqn09@uc3.scc.kit.edu:~/als_foundation_model/src/
scp scripts/install_sra_toolkit.sh ul_oqn09@uc3.scc.kit.edu:~/als_foundation_model/scripts/

echo "Transfer complete!"
echo ""
echo "ğŸš€ READY TO FIX SRA DOWNLOAD ISSUES!"
echo ""
echo "On the cluster, run these commands:"
echo ""
echo "1. Install SRA Toolkit:"
echo "   cd ~/als_foundation_model"
echo "   chmod +x scripts/install_sra_toolkit.sh"
echo "   ./scripts/install_sra_toolkit.sh"
echo ""
echo "2. Test SRA Toolkit:"
echo "   export PATH=\"\$HOME/sra_toolkit/bin:\$PATH\""
echo "   prefetch --version"
echo "   fasterq-dump --version"
echo ""
echo "3. Run the updated pipeline:"
echo "   sbatch scripts/run_parallel_optimized_pipeline.slurm"
echo ""
echo "Expected improvements:"
echo "- âœ… SRA downloads will work (no more 'esearch' errors)"
echo "- âœ… Multiple fallback methods for SRA data"
echo "- âœ… Better error handling and logging"
echo "- âœ… Proper SRA to FASTQ conversion"
echo "- âœ… Entrez API integration for metadata"
echo ""
echo "The pipeline will now:"
echo "1. ğŸ” Search for SRA data using Entrez API"
echo "2. ğŸ“¥ Download SRA files using prefetch"
echo "3. ğŸ”„ Convert SRA to FASTQ using fasterq-dump"
echo "4. ğŸ“Š Extract metadata for each run"
echo "5. ğŸ›¡ï¸ Handle errors gracefully with fallbacks"
